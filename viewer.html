<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Site Viewer</title>
</head>
<body>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-app.js";
        import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/12.2.1/firebase-firestore.js";
        
        // Hardcoded Firebase configuration.
        const firebaseConfig = {
            apiKey: "AIzaSyD_wua7IXkOgDQ08rJ-UmLBVyEoDkd5z40",
            authDomain: "sitemaker-8dc01.firebaseapp.com",
            projectId: "sitemaker-8dc01",
            storageBucket: "sitemaker-8dc01.firebasestorage.app",
            messagingSenderId: "816747054758",
            appId: "1:816747054758:web:d369bc875fa4dda1eb5667",
            measurementId: "G-7SFR36ZJYF"
        };
        
        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // Function to load and display the raw site content
        const loadRawSite = async () => {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const siteId = urlParams.get('site');
                const pageName = urlParams.get('page') || 'index.html'; // Get the requested page, or default to index.html
                
                if (!siteId) {
                    console.error("Error: No site ID provided in the URL.");
                    document.body.innerHTML = '<h1>Site Not Found</h1><p>Please return to the <a href="./index.html">Site Builder</a>.</p>';
                    return;
                }

                const projectRef = doc(db, 'sites', siteId);
                const docSnap = await getDoc(projectRef);

                if (docSnap.exists()) {
                    const projectData = docSnap.data();
                    const files = projectData.files;
                    let fileContent = files[pageName];

                    if (fileContent) {
                        // Display the requested file's content
                        document.documentElement.innerHTML = fileContent;
                    } else if (files['index.html']) {
                        // Fallback to index.html if the requested page is not found
                        console.warn(`Warning: Page '${pageName}' not found. Displaying 'index.html' instead.`);
                        document.documentElement.innerHTML = files['index.html'];
                    } else {
                        // No index.html or requested page found
                        console.error(`Error: The page '${pageName}' could not be found for site '${siteId}'.`);
                        document.body.innerHTML = '<h1>Page Not Found</h1><p>The main page for this site could not be found.</p>';
                    }

                } else {
                    console.error(`Error: Site '${siteId}' not found.`);
                    document.body.innerHTML = '<h1>Site Not Found</h1><p>The requested site does not exist.</p>';
                }
            } catch (e) {
                console.error("An unexpected error occurred while loading the site:", e);
                document.body.innerHTML = '<h1>Loading Error</h1><p>An unexpected error occurred.</p>';
            }
        };

        window.onload = loadRawSite;
    </script>
</body>
</html>
